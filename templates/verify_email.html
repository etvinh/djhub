{% extends "login.html" %}

{% block title %}Verify Email Â· DJHub{% endblock %}

{% block auth_heading %}Verify your email{% endblock %}
{% block auth_subtitle %}Enter the 6-digit code sent to {{ email }}{% endblock %}

{% block auth_form %}
<style>
  .code-row{
    display: grid;
    grid-template-columns: repeat(6, minmax(0, 1fr));
    gap: 10px;
    margin: 14px 0 8px;
  }
  .code-input{
    height: 54px;
    border-radius: 12px;
    border: 1px solid #e2e8f0;
    background: #f8fafc;
    text-align: center;
    font-size: 20px;
    font-weight: 900;
    letter-spacing: 0.1em;
  }
  .code-actions{
    margin-top: 12px;
    display: grid;
    gap: 10px;
  }
  .btn-link{
    background: transparent;
    border: 0;
    color: #3b5bff;
    font-weight: 900;
    cursor: pointer;
  }
  .btn-link:hover{
    text-decoration: underline;
  }
</style>

<form method="POST" action="{{ url_for('verify_email') }}" autocomplete="one-time-code">
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
  <div class="code-row" id="codeRow">
    {% for i in range(1, 7) %}
      <input
        class="code-input"
        type="text"
        inputmode="numeric"
        pattern="[0-9]*"
        maxlength="1"
        name="code_{{ i }}"
        aria-label="Digit {{ i }}"
        {% if i == 1 %}autofocus{% endif %}
      >
    {% endfor %}
  </div>
  <button type="submit" class="btn-primary">Verify code</button>
</form>

<div class="code-actions">
  <form method="POST" action="{{ url_for('resend_verification') }}">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <button type="submit" class="btn-link">Resend verification code</button>
  </form>
</div>

<script>
  const codeRow = document.getElementById("codeRow");
  if (codeRow) {
    const inputs = Array.from(codeRow.querySelectorAll("input"));
    inputs.forEach((input, idx) => {
      input.addEventListener("input", () => {
        input.value = input.value.replace(/\D/g, "");
        if (input.value && inputs[idx + 1]) {
          inputs[idx + 1].focus();
        }
      });
      input.addEventListener("keydown", (e) => {
        if (e.key === "Backspace" && !input.value && inputs[idx - 1]) {
          inputs[idx - 1].focus();
        }
      });
      input.addEventListener("paste", (e) => {
        const data = (e.clipboardData || window.clipboardData).getData("text");
        if (!data) return;
        const digits = data.replace(/\D/g, "").slice(0, 6).split("");
        if (!digits.length) return;
        e.preventDefault();
        digits.forEach((d, i) => {
          if (inputs[i]) inputs[i].value = d;
        });
        const next = inputs[Math.min(digits.length, inputs.length - 1)];
        next?.focus();
      });
    });
  }
</script>
{% endblock %}

{% block auth_actions %}
<div class="divider">or</div>
<div class="alt-actions">
  <a href="{{ url_for('login') }}" class="btn-secondary">
    Back to login
  </a>
</div>
{% endblock %}
