<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}DJHub{% endblock %}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700;800;900&family=Orbitron:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@400" />
    <style>
        :root{
          --font: "Orbitron", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
          --bg: #ffffff;
          --bg-2: #ffffff;
          --text: #0f172a;
          --muted: rgba(100,116,139,0.9);
          --glass: rgba(15,23,42,0.04);
          --glass-border: rgba(15,23,42,0.08);
          --nav-bg: rgba(8, 12, 24, 0.72);
          --nav-border: rgba(255,255,255,0.10);
          --nav-text: rgba(255,255,255,0.92);
          --nav-muted: rgba(226,232,240,0.78);
          --nav-pill: rgba(255,255,255,0.10);
          --nav-pill-border: rgba(255,255,255,0.14);
          --blue: #4f7cff;
        }

        /* Flash messages (keep your existing) */
        .flash-wrap{ position: relative; z-index: 2; }
        .flash-message { padding: 10px; margin-bottom: 15px; border-radius: 10px; font-weight: 700; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .danger { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }

        /* ===== NAVBAR: dark/glassy like the reference ===== */
        body{
          margin: 0;
          font-family: var(--font);
          color: var(--text);
          background: var(--bg);
          position: relative;
          overflow-x: hidden;
          -webkit-font-smoothing: antialiased;
          text-rendering: optimizeLegibility;
        }
        *, *::before, *::after{ box-sizing: border-box; }
        a{ transition: color 160ms ease, opacity 160ms ease; }
        a:hover{ opacity: 0.95; }
        button,
        .primary-btn,
        .ghost-btn,
        .msg-btn,
        .booking-btn,
        .pill,
        .review-btn,
        .card-link{
          transition: transform 160ms ease, box-shadow 200ms ease, filter 160ms ease, background 200ms ease, border-color 200ms ease;
        }
        button:hover,
        .primary-btn:hover,
        .ghost-btn:hover,
        .msg-btn:hover,
        .booking-btn:hover,
        .pill:hover,
        .review-btn:hover,
        .card-link:hover{
          transform: translateY(-1px);
          filter: brightness(1.02);
        }
        input, textarea, select{
          transition: border-color 160ms ease, box-shadow 200ms ease, background 200ms ease;
        }
        :where(.card, .detail-card, .booking-card, .listing-card, .profile-card, .chat-shell, .card-link){
          transition: transform 180ms ease, box-shadow 220ms ease, border-color 220ms ease;
        }
        :where(.card, .detail-card, .booking-card, .listing-card, .profile-card, .chat-shell, .card-link):hover{
          transform: translateY(-2px);
          box-shadow: 0 18px 40px rgba(8,12,24,0.35);
        }
        :focus-visible{
          outline: 2px solid rgba(108,75,255,0.7);
          outline-offset: 2px;
        }
        @keyframes riseIn{
          from{ opacity: 0; transform: translateY(8px); }
          to{ opacity: 1; transform: translateY(0); }
        }
        @media (prefers-reduced-motion: reduce){
          *{ animation: none !important; transition: none !important; }
        }
        main, .navbar{
          position: relative;
          z-index: 1;
        }

        .navbar{
          position: sticky;
          top: 0;
          z-index: 50;
          display: flex;
          align-items: center;
          justify-content: center;
          padding: 6px 6px;
          background: linear-gradient(to bottom, rgba(8,12,24,0.78), rgba(8,12,24,0.55));
          border-bottom: 1px solid var(--nav-border);
          backdrop-filter: blur(10px);
          -webkit-backdrop-filter: blur(10px);
        }

        .nav-inner{
          width: 100%;
          max-width: 100%;
          padding: 0 2px;
          display: flex;
          align-items: center;
          gap: 12px;
        }

        .brand{
          width: 46px;
          height: 46px;
          border-radius: 999px;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          color: #fff;
          text-decoration: none;
          font-weight: 900;
          letter-spacing: 0.08em;
          position: relative;
          border: 0;
          background: transparent;
          cursor: pointer;
        }
        .brand::before{
          content: "";
          position: absolute;
          inset: 0;
          border-radius: 999px;
          background: url("{{ url_for('static', filename='img/homedisc.png') }}") center / cover no-repeat;
          -webkit-mask-image: radial-gradient(circle at center, #000 99%, transparent 100%);
          mask-image: radial-gradient(circle at center, #000 99%, transparent 100%);
          transition: transform 400ms ease;
        }
        .brand:hover::before{ transform: rotate(180deg); }
        .brand-mark{
          position: relative;
          z-index: 1;
          width: 34px;
          height: 34px;
          border-radius: 999px;
          background: rgba(15,23,42,0.65);
          border: 1px solid rgba(255,255,255,0.12);
          display: inline-flex;
          align-items: center;
          justify-content: center;
          font-weight: 900;
          color: #fff;
          font-size: 12px;
        }
        .brand-name{ display: none; }

        .nav-links{
          display: flex;
          align-items: center;
          gap: 8px;
          flex-wrap: wrap;
        }

        .nav-link{
          color: var(--nav-text);
          text-decoration: none;
          font-weight: 800;
          font-size: 13px;
          padding: 9px 12px;
          border-radius: 999px;
          border: 1px solid transparent;
          transition: background 120ms ease, border-color 120ms ease;
          position: relative;
        }
        .nav-link:hover{
          background: var(--nav-pill);
          border-color: var(--nav-pill-border);
        }
        .nav-badge{
          position: absolute;
          top: 0;
          right: -6px;
          display:inline-flex;
          align-items:center;
          gap: 4px;
          padding: 2px 6px;
          border-radius: 999px;
          color: #ef4444;
          font-size: 11px;
          font-weight: 900;
        }
        .nav-badge::before{
          content: "";
          width: 6px;
          height: 6px;
          border-radius: 999px;
          background: #ef4444;
        }

        .nav-spacer{ flex: 1; }

        .nav-right{
          display: flex;
          align-items: center;
          gap: 10px;
        }

        .user-info{
          color: var(--nav-muted);
          font-weight: 800;
          font-size: 13px;
          white-space: nowrap;
        }

        .icon-btn{
          display: inline-flex;
          align-items: center;
          justify-content: center;
          width: 40px;
          height: 40px;
          border-radius: 999px;
          border: 1px solid var(--glass-border);
          background: rgba(255,255,255,0.10);
          text-decoration: none;
          transition: filter 120ms ease, transform 120ms ease;
          position: relative;
        }
        .icon-btn:hover{ filter: brightness(1.05); transform: translateY(-1px); }

        .icon-btn .material-symbols-outlined{
          font-size: 20px;
          color: #fff;
          opacity: 0.95;
          line-height: 1;
        }
        .icon-avatar{
          width: 28px;
          height: 28px;
          border-radius: 999px;
          object-fit: cover;
          border: 1px solid rgba(255,255,255,0.65);
        }

        .primary-btn{
          display: inline-flex;
          align-items: center;
          justify-content: center;
          height: 40px;
          padding: 0 14px;
          border-radius: 999px;
          background: var(--blue);
          color: #fff;
          font-weight: 900;
          font-size: 13px;
          text-decoration: none;
          border: 0;
        }
        .primary-btn:hover{ filter: brightness(0.95); }

        .ghost-btn{
          display: inline-flex;
          align-items: center;
          justify-content: center;
          height: 40px;
          padding: 0 14px;
          border-radius: 999px;
          background: rgba(255,255,255,0.10);
          color: #fff;
          font-weight: 900;
          font-size: 13px;
          text-decoration: none;
          border: 1px solid var(--nav-pill-border);
        }
        .ghost-btn:hover{ filter: brightness(1.05); }

        .msg-btn{
          display:inline-flex;
          align-items:center;
          justify-content:center;
          height: 36px;
          padding: 0 14px;
          border-radius: 999px;
          border: 1px solid rgba(255,255,255,0.16);
          background: #6c4bff;
          color: #fff;
          font-weight: 900;
          font-size: 12px;
          text-decoration: none;
          cursor: pointer;
        }
        .msg-btn.secondary{
          background: rgba(255,255,255,0.10);
          color: #fff;
          border: 1px solid rgba(255,255,255,0.18);
        }
        .msg-btn.link{
          text-decoration: none;
        }

        main{
          max-width: 1100px;
          margin: 0 auto;
          padding: 0 16px 60px;
          animation: riseIn 420ms ease both;
        }

        .toast-stack{
          position: fixed;
          top: 78px;
          right: 18px;
          display: grid;
          gap: 10px;
          z-index: 200;
          max-width: min(360px, 92vw);
        }
        .toast{
          display:flex;
          align-items:flex-start;
          gap: 10px;
          padding: 12px 14px;
          border-radius: 14px;
          border: 1px solid rgba(255,255,255,0.14);
          background: rgba(15,23,42,0.92);
          box-shadow: 0 18px 40px rgba(2,6,23,0.35);
          color: #f8fafc;
          font-weight: 800;
          font-size: 12px;
          animation: riseIn 320ms ease both;
        }
        .toast.success{ border-color: rgba(34,197,94,0.4); }
        .toast.danger{ border-color: rgba(239,68,68,0.45); }
        .toast.info{ border-color: rgba(56,189,248,0.45); }
        .toast.warning{ border-color: rgba(234,179,8,0.5); }
        .toast .toast-close{
          margin-left: auto;
          background: transparent;
          border: 0;
          color: inherit;
          font-weight: 900;
          cursor: pointer;
        }

        .fab{
          position: fixed;
          right: 20px;
          bottom: 20px;
          z-index: 80;
          display: inline-flex;
          align-items: center;
          gap: 8px;
          padding: 12px 16px;
          border-radius: 999px;
          background: linear-gradient(140deg, #7c4dff, #4f7cff);
          color: #fff;
          text-decoration: none;
          font-weight: 900;
          box-shadow: 0 18px 40px rgba(76,55,255,0.35);
          border: 1px solid rgba(255,255,255,0.16);
        }
        .fab .material-symbols-outlined{ font-size: 18px; }

        .stat-chips{
          display: flex;
          flex-wrap: wrap;
          gap: 8px;
        }
        .stat-chip{
          display: inline-flex;
          align-items: center;
          gap: 6px;
          padding: 6px 10px;
          border-radius: 999px;
          background: rgba(255,255,255,0.10);
          border: 1px solid rgba(255,255,255,0.18);
          color: rgba(255,255,255,0.9);
          font-weight: 900;
          font-size: 11px;
          letter-spacing: 0.04em;
          text-transform: uppercase;
        }

        .segmented{
          display: inline-flex;
          background: rgba(255,255,255,0.10);
          border: 1px solid rgba(255,255,255,0.18);
          border-radius: 999px;
          padding: 4px;
          gap: 4px;
        }
        .segmented input{
          position: absolute;
          opacity: 0;
          pointer-events: none;
        }
        .segmented label{
          padding: 6px 12px;
          border-radius: 999px;
          font-size: 11px;
          font-weight: 900;
          text-transform: uppercase;
          letter-spacing: 0.04em;
          color: rgba(255,255,255,0.9);
          cursor: pointer;
        }
        .segmented input:checked + label{
          background: rgba(255,255,255,0.18);
          color: #fff;
        }

        .tilt-card{
          transform-style: preserve-3d;
          perspective: 800px;
          position: relative;
        }
        .tilt-card::after{
          content: "";
          position: absolute;
          inset: -1px;
          background: radial-gradient(420px 220px at 20% 0%, rgba(255,255,255,0.18), transparent 60%);
          opacity: 0;
          transition: opacity 240ms ease;
          pointer-events: none;
        }
        .tilt-card:hover::after{ opacity: 1; }

        .global-loader{
          position: fixed;
          inset: 0;
          display: none;
          align-items: center;
          justify-content: center;
          background: rgba(8,12,24,0.7);
          backdrop-filter: blur(4px);
          z-index: 300;
        }
        .global-loader.active{ display: flex; }
        .loader-disc{
          width: 90px;
          height: 90px;
          border-radius: 999px;
          background: url("{{ url_for('static', filename='img/homedisc.png') }}") center / cover no-repeat;
          animation: spin 1.4s linear infinite;
          box-shadow: 0 12px 30px rgba(2,6,23,0.45);
        }
        .loader-text{
          margin-top: 12px;
          font-weight: 900;
          letter-spacing: 0.08em;
          text-transform: uppercase;
          font-size: 11px;
          color: #e2e8f0;
          text-align: center;
        }
        @keyframes spin{
          to{ transform: rotate(360deg); }
        }

        /* Mobile */
        @media (max-width: 640px){
          .user-info{ display:none; }
        }
    </style>
</head>
<body data-authenticated="{{ 'true' if current_user.is_authenticated else 'false' }}">

    <nav class="navbar">
      <div class="nav-inner">

        <button class="icon-btn" type="button" id="drawerToggle" aria-controls="appDrawer" aria-expanded="false" title="Menu">
          <span class="material-symbols-outlined" aria-hidden="true">menu</span>
        </button>

        <!-- Brand (home) -->
        <a class="brand" href="{{ url_for('listings_feed') }}">
          <span class="brand-mark">DJ</span>
          <span class="brand-name">DJHub</span>
        </a>

        <!-- Left links (same buttons as before) -->
        <div class="nav-links">
          <a class="nav-link" href="{{ url_for('profile_search') }}">Search Profiles</a>
          {% if current_user.is_authenticated %}
            <a class="nav-link" href="{{ url_for('my_listings') }}">
              My Listings
              {% if pending_booking_count %}
                <span class="nav-badge"></span>
              {% endif %}
            </a>
            <a class="nav-link" href="{{ url_for('my_bookings') }}">
              My Bookings
              {% if booking_updates_count %}
                <span class="nav-badge"></span>
              {% endif %}
            </a>
          {% endif %}

          {% if current_user.is_authenticated %}
            <!-- Messages icon button (same logic + same route) -->
            <a class="icon-btn"
               href="{{ url_for('inbox') }}"
               title="Inbox">
              <span class="material-symbols-outlined" aria-hidden="true">inbox</span>
              {% if unread_messages_count %}
                <span class="nav-badge"></span>
              {% endif %}
            </a>
          {% endif %}
        </div>

        <div class="nav-spacer"></div>

        <!-- Right side (same buttons as before) -->
        <div class="nav-right">
          {% if current_user.is_authenticated %}
            <span class="user-info">Welcome, <b style="color:#fff;">{{ current_user.username }}</b></span>
            <a class="icon-btn" href="{{ url_for('my_profile') }}" title="My profile">
              {% if current_user_profile and current_user_profile.avatar_url %}
                <img class="icon-avatar" src="{{ current_user_profile.avatar_url }}" alt="Profile">
              {% else %}
                <span class="material-symbols-outlined" aria-hidden="true">account_circle</span>
              {% endif %}
            </a>
            <a class="ghost-btn" href="{{ url_for('logout') }}">Logout</a>
          {% else %}
            <a class="ghost-btn" href="{{ url_for('login') }}">Login</a>
            <a class="primary-btn" href="{{ url_for('signup') }}">Sign Up</a>
          {% endif %}
        </div>

      </div>
    </nav>

    <div class="app-drawer" id="appDrawer" aria-hidden="true">
      <div class="drawer-overlay" data-drawer-close></div>
      <div class="drawer-panel" role="dialog" aria-modal="true" aria-label="Navigation drawer">
        <div class="drawer-header">
          <span class="drawer-title">DJHub</span>
          <button class="drawer-close" type="button" data-drawer-close aria-label="Close drawer">✕</button>
        </div>
        <div class="drawer-links">
          <a class="drawer-link" href="{{ url_for('listings_feed') }}">Home</a>
          <a class="drawer-link" href="{{ url_for('my_listings') }}" data-auth-required="true">My Listings</a>
          <a class="drawer-link" href="{{ url_for('my_bookings') }}" data-auth-required="true">My Bookings</a>
          <a class="drawer-link" href="{{ url_for('about') }}">About</a>
        </div>
        <div class="drawer-auth" id="drawerAuth" aria-hidden="true">
          <div class="drawer-auth-title">Sign in required</div>
          <div class="drawer-auth-text">Log in or create an account to continue.</div>
          <div class="drawer-auth-actions">
            <a class="drawer-auth-btn primary" href="{{ url_for('login') }}">Login</a>
            <a class="drawer-auth-btn" href="{{ url_for('signup') }}">Sign Up</a>
            <button class="drawer-auth-btn ghost" type="button" data-auth-close>Cancel</button>
          </div>
        </div>
      </div>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="toast-stack" id="toastStack">
          {% for category, message in messages %}
            <div class="toast {{ category }}">
              <span>{{ message }}</span>
              <button class="toast-close" type="button" aria-label="Dismiss">✕</button>
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <main>
        {% block content %}{% endblock %}
    </main>

    {% block scripts %}{% endblock %}

    <div class="global-loader" id="globalLoader" aria-hidden="true">
      <div>
        <div class="loader-disc"></div>
        <div class="loader-text">Loading</div>
      </div>
    </div>

    <script>
      const drawer = document.getElementById("appDrawer");
      const drawerToggle = document.getElementById("drawerToggle");
      const closeDrawer = () => {
        if (!drawer) return;
        drawer.classList.remove("open");
        drawer.setAttribute("aria-hidden", "true");
        drawerToggle?.setAttribute("aria-expanded", "false");
        document.body.classList.remove("drawer-open");
      };
      const openDrawer = () => {
        if (!drawer) return;
        drawer.classList.add("open");
        drawer.setAttribute("aria-hidden", "false");
        drawerToggle?.setAttribute("aria-expanded", "true");
        document.body.classList.add("drawer-open");
      };
      drawerToggle?.addEventListener("click", () => {
        if (!drawer) return;
        drawer.classList.contains("open") ? closeDrawer() : openDrawer();
      });
      drawer?.querySelectorAll("[data-drawer-close]").forEach((el) => {
        el.addEventListener("click", closeDrawer);
      });
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") closeDrawer();
      });

      const drawerAuth = document.getElementById("drawerAuth");
      const isAuthed = document.body.getAttribute("data-authenticated") === "true";
      const openAuthDrawer = () => {
        if (!drawerAuth) return;
        openDrawer();
        drawerAuth.classList.add("open");
        drawerAuth.setAttribute("aria-hidden", "false");
      };
      const closeAuthDrawer = () => {
        if (!drawerAuth) return;
        drawerAuth.classList.remove("open");
        drawerAuth.setAttribute("aria-hidden", "true");
      };
      drawerAuth?.querySelectorAll("[data-auth-close]").forEach((el) => {
        el.addEventListener("click", closeAuthDrawer);
      });
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") closeAuthDrawer();
      });
      document.addEventListener("click", (e) => {
        const link = e.target.closest("a[data-auth-required]");
        if (!link || isAuthed) return;
        e.preventDefault();
        openAuthDrawer();
      });

      const toastStack = document.getElementById("toastStack");
      if (toastStack) {
        toastStack.querySelectorAll(".toast").forEach((toast) => {
          const closeBtn = toast.querySelector(".toast-close");
          const timer = setTimeout(() => toast.remove(), 4200);
          closeBtn?.addEventListener("click", () => {
            clearTimeout(timer);
            toast.remove();
          });
        });
      }

      const globalLoader = document.getElementById("globalLoader");
      document.querySelectorAll("form").forEach((form) => {
        form.addEventListener("submit", () => {
          if (!globalLoader) return;
          const method = (form.getAttribute("method") || "get").toLowerCase();
          if (method !== "post") return;
          globalLoader.classList.add("active");
          globalLoader.setAttribute("aria-hidden", "false");
        });
      });
    </script>
</body>
</html>
